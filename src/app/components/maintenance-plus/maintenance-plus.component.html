<div class="page-holder">
  <div class="page-header">
    <div class="page-title">
      MAINTENANCE+
    </div>
    <div class="page-stats">
      <div class="number-label">
        {{OpenNum}} Open
      </div>
      <div class="number-label">
        {{InProgressNum}} In Progress
      </div>
      <div class="number-label">
        {{VendorRequiredNum}} Vendors Required
      </div>
      <div class="number-label">
        {{AuctionCreatedNum}} Auction Created
      </div>
      <div class="number-label">
        {{VendorAssignedNum}} Vendor Assigned
      </div>
      <div class="number-label">
        {{VendorInProgressNum}} Vendor In Progress 
      </div>
      <div class="number-label">
        {{VendorResolvedNum}} Vendor Resolved
      </div>
      <div class="number-label">
        {{ResolvedNum}} Resolved
      </div>
      <div class="number-label">
        {{DoneNum}} Done
      </div>
    </div>
  </div>
  <div class="maint-content">
    <div class="maint-content-header">
      <div class="merge-tickets" [ngClass]="{'clickable': canMerge}" (click)="mergeTickets()">
        <img src="/assets/img/mergeTicketsIcon.png">
        <div class="merge-tickets-label">Merge Tickets</div>
      </div>
      <div class="query-form">
        <div class="dropdown">
          <label for="sortBy">Sort By:</label>
          <select id="sortBy" [(ngModel)]="sortBy" class="sortBy">
            <option value="MaintenanceAddress" >Unit</option>
            <option value="ticketNumber">Ticket Number</option>
            <option value="TicketDate$" selected>Most Recent</option>
            <option value="lastUpdateDate$">Last Updated</option>
            <option value="TicketDate">Oldest</option>
          </select>
        </div>
        <div class="dropdown">
          <label for="show">Show:</label>
          <select id="show" [(ngModel)]="showBy" class="show">
            <option value="All">All</option>
            <option value="Open">Open</option>
            <option value="In_Progress">In Progress</option>
            <option value="Vendor_Required">Vendor Required</option>
            <option value="Auction_Created">Auction Created</option>
            <option value="Vendor_Assigned">Vendor Assigned</option>
            <option value="Vendor_In_Progress">Vendor In Progress</option>
            <option value="Vendor_Resolved">Vendor Resolved</option>
            <option value="Resolved">Resolved</option>
            <option value="Done">Done</option>
          </select>
        </div>
        <div class="query-search">
          <input type="text" [(ngModel)]="searchQuery" placeholder="Search by ticket, apt, date etc...">
        </div>
      </div>
    </div>
    <div class="table-header lease-row">
        <div class="col-1"> UNIT</div>
        <div class="col-2"> STATUS</div>
        <div class="col-3"> ID</div>
        <div class="col-4"> TITLE</div>
        <div class="col-5"> CREATED</div>
        <div class="col-6"> UPDATED</div>
        <div class="col-7"> ATTACHMENTS</div>
        <div class="col-8"> ASSIGNED</div>
        <div class="col-9"> &nbsp;</div>
        <!-- <div class="col-7"> &nbsp;</div> -->
      </div>
      <div *ngIf="mainMessage" class="main-message">
          <img *ngIf="mainMessage === 'Loading...'" src="/assets/img/loader_big.gif" alt="">
          <ng-container *ngIf="mainMessage !== 'Loading...'">
            {{mainMessage}}
          </ng-container>
        </div>
    <div *ngIf="tickets.length > 0" class="tickets-holder">
      <div class="ticket" *ngFor="let ticket of (tickets | searchTicket:searchQuery | sortByPipe:sortBy | filterByStatus:showBy )">
        <div class="ticket-check-box">
          <div class="c2-check-box" (click)="ticket.selected = !ticket.selected; countSelectedTickets()">
            <div *ngIf="ticket.selected" class="c2-check-box-checked"></div>
          </div>
        </div>
        <div [class]="'ticket-body clickable ' + ticket.status" (click)="ticket.showDetails = !ticket.showDetails">
          <div class="apt-name">
            <span *ngIf="ticket.problemArea !== 'ComplexArea'">{{ticket.MaintenanceAddress ? ticket.MaintenanceAddress : ''}}</span>
            <svg *ngIf="ticket.problemArea === 'ComplexArea'" width="27" height="20" viewBox="0 0 27 20">
              <use xlink:href="./assets/icons.svg#facility"></use>
            </svg>
          </div>
          <div class="ticket-number-status">
            <div class="ticket-number"></div>
            <div class="ticket-status">{{statuses[ticket.status]}}</div>
            <div class="info-status">
              <img src="/assets/img/info.png">
              <div class="tooltip">
                  <span>{{moment(ticket.lastUpdateDate).format('DD MMM YY hh:mm A')}}</span> <br />
                  <span>{{ticket.lastUpdateFullname}}</span><br />
                  <span>{{ticket.lastUpdateEmail}}</span><br />
                  <span>{{ticket.lastUpdatePosition}}</span>
                </div>
              </div>
            </div>
            <div class="ticket-id">
              {{ticket.ticketNumber}}
          </div>
          <div class="ticket-description">
              {{ticket.TicketTitle}}<br />
              {{ticket.TicketSubTitle}}
          </div>
          <div class="ticket-date">
            {{moment(ticket.createdDate).format('DD MMM YY hh:mm A')}}
            <div class="gist-icon info-status-created">
              <img src="/assets/img/info.png">
              <div class="tooltip">
                  <span>{{ticket.createdFullname}}</span> <br />
                  <span>{{ticket.createdEmail}}</span> <br />
                  <span>{{ticket.createdPosition}}</span>
                </div>
              </div>
          </div>
          <div class="ticket-date">
            {{moment(ticket.lastUpdateDate).format('DD MMM YY hh:mm A')}}
            <div class="gist-icon info-status-updated">
              <img src="/assets/img/info.png">
              <div class="tooltip">
                  <span>{{ticket.lastUpdateTitle?.substring(0, 20)}}</span> <br />
                  <span>{{ticket.lastUpdateTitle?.substring(20, 50)}}</span> <br *ngIf="ticket.lastUpdateTitle?.length > 20" />
                  <span>{{ticket.lastUpdateFullname}}</span> <br />
                  <span>{{ticket.lastUpdateEmail}}</span> <br />
                  <span>{{ticket.lastUpdatePosition}}</span>
                </div>
              </div>
          </div>
          <div class="ticket-options">
            <img *ngIf="ticket.moreInfo && ticket.moreInfo.length > 0 && false" src="/assets/img/info.png">
            <img *ngIf="ticket.mainImg && ticket.mainImg.length > 0" src="/assets/img/photoIcon.png">
            <img *ngIf="ticket.groupChatKey" src="/assets/img/messagesIconGrey.png">
          </div>
          <div class="ticket-chat">
            <div *ngIf="show == 'Janitor'">
              <div *ngIf="!ticket.estimatedWorkTime || ticket.estimatedWorkTime.length == 0">
                <a (click)="navigateToChatWithTenant(ticket.joinedPeople[0], ticket.joinedPeople[0].apartmentName)">Chat</a> with tenant to schedule a service slot</div>
              <div *ngIf="ticket.estimatedWorkTime && ticket.estimatedWorkTime.length != 0">{{moment(ticket.estimatedWorkTime).toNow(true)}}</div>
            </div>
            <div *ngIf="show !== 'Janitor'">
              <div *ngIf="ticket.status == statuses.Vendor" class="request-sent">
                <div class="title">Vendor request sent</div>
                <div class="time" style="text-align: left;">
                  <ng-container *ngIf="!isPast(ticket.offerDeadline)">
                    Offers can be received<br>until {{moment(ticket.offerDeadline).format('DD MMM YY hh:mm A')}}
                  </ng-container>
                  <ng-container *ngIf="isPast(ticket.offerDeadline)">
                    Offers application are now closed
                  </ng-container>
                </div>
              </div>
              <div *ngIf="ticket.status != statuses.Open && false">
                  <div class="ticket-gist">
                    <div class="gist-icon">
                      <img src="/assets/img/hours_icon.png">
                    </div>
                    <div class="gist-text">
                      <div *ngIf="ticket.lastUpdateDate" style="text-align: left;">{{moment(ticket.lastUpdateDate).format('DD MMM YY hh:mm A')}}</div>
                    </div>
                  </div>
                  <div class="ticket-gist">
                    <div class="gist-icon">
                      <img src="/assets/img/messagesIconGrey.png">
                    </div>
                    <div class="gist-text">
                      <div *ngIf="ticket.lastUpdateMsg" style="text-align: left;">{{ticket.lastUpdateMsg | slice: 0 : 50}}</div>
                    </div>
                  </div>
                </div>
                <div style="margin-left: -3%;" *ngIf="ticket.vendorAssignedName && ticket.vendorAssignedDate && isVendorAssigned(ticket)">
                    <div class="ticket-gist">
                        <div class="gist-text">
                          <div style="text-align: left; margin-left: 5%;" class="hideText">
                            <span class="C2-color">Vendor : </span>
                            {{ticket.vendorAssignedName | slice: 0 : 50}}</div>
                        </div>
                      </div>
                    <div class="ticket-gist">
                      <div class="gist-text">
                        <div style="text-align: left;color: #909090; margin-left: 5%;">
                            <span class="C2-color">Scheduled : </span>
                          {{moment(ticket.vendorAssignedDate).format('MMM DD, YY hh:mm A')}}</div>
                      </div>
                    </div>
                  </div>
                  <div style="margin-left: -3%;" *ngIf="!isVendorAssigned(ticket) && ticket.internalAssignments.length > 0">
                      <div class="ticket-gist">
                          <div class="gist-text">
                            <div style="text-align: left; margin-left: 5%;" class="hideText" *ngIf="ticket.internalAssignments.length == 1">
                              <span class="C2-color">Staff : </span>
                              {{ticket.internalAssignments[0].responseDisplayName | slice: 0 : 50}}</div>
                            <div style="text-align: left; margin-left: 5%;" class="hideText" *ngIf="ticket.internalAssignments.length > 1">
                              <span class="C2-color">Staff : </span>
                              {{ticket.internalAssignments.length}} staff members</div>
                          </div>
                        </div>
                      <div class="ticket-gist">
                        <div class="gist-text">
                          <div style="text-align: left;color: #909090; margin-left: 5%;">
                              <span class="C2-color">Scheduled : </span>
                            {{moment(ticket.internalAssignments[0].assignmentDateLong).format('MMM DD, YY hh:mm A')}}</div>
                        </div>
                      </div>
                    </div>
            </div>
          </div>
        </div>
        <div class="ticket-button">
          <div *ngIf="show == 'Janitor'">
            <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === statuses.Open" class="c2-ok-button"
              (click)="showSetTimeDialog(ticket)">TIME ESTIMATE</button>
            <div *ngIf="ticket.estimatedWorkTime && ticket.estimatedWorkTime.length != 0 && ticket.status === statuses.In_Progress" class="work-scheduled">
              <div>Work Scheduled</div>
            </div>
            <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'In_Progress'" class="c2-cancel-button add-c2-cancel-button" (click)="vendorRequired(ticket)"> VENDOR REQUIRED</button>
            <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'In_Progress'" class="c2-ok-button add-c2-ok-button" (click)="openFixedDialog(ticket)"> FIXED </button>
          </div>
          <div style="text-align: center;" *ngIf="show == 'Location Manager'">
            <div class="buttons">
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Open'" class="c2-cancel-button add-c2-cancel-button" (click)="vendorRequired(ticket)"> VENDOR REQUIRED</button>
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Open'" class="c2-ok-button add-c2-ok-button" (click)="clickMarkAsFix(ticket)"> FIXED </button> 

              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Assigned'" class="c2-ok-button" (click)="sendRemainderToStaff(ticket)">SEND REMAINDER</button>

              <!-- <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Vendor_Required'" class="c2-ok-button" (click)="showGetVendorDialog(ticket)">GET VENDOR OFFER</button> -->
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Vendor_Required'" class="c2-ok-button" (click)="showGetVendorDialog(ticket)">CREATE AUCTION</button>

              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Auction_Created'" class="c2-cancel-button add-c2-cancel-button" (click)="showGetVendorDialog(ticket)"> VIEW AUCTION</button>
              <span *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Auction_Created' && ticket.numberOfOffersPerTicket === 0" class="no-offers C2-no-offers-add">No Offers Yet</span>
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && (ticket.status ===  'Auction_Created') && ticket.numberOfOffersPerTicket > 0" class="c2-ok-button add-c2-ok-button" (click)="showVendorOffersResponses(ticket)"> VIEW OFFERS </button>
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && (ticket.status ===  'Vendor_Assigned') && ticket.numberOfOffersPerTicket > 0" class="c2-ok-button" (click)="showVendorOffersResponses(ticket)"> REVIEW ASSIGNED </button>
              <div class="notification-num" *ngIf="ticket.numberOfOffersPerTicket !== 0 &&  ticket.status ===  'Auction_Created' ">{{ticket.numberOfOffersPerTicket}} </div>

              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Vendor_Resolved'" class="c2-ok-button" (click)="openRatingDialog(ticket)"> CLOSE & RATE </button>  

              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Resolved'" class="c2-ok-button" (click)="openResolvedDialog(ticket)"> VIEW INFO </button>
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Done'" class="c2-ok-button" (click)="openDoneDialog(ticket)"> VIEW INFO </button>    
              <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status == statuses.New" class="c2-cancel-button"(click)="sendReminderToJanitor(ticket)">SEND A REMINDER</button>
            </div>

            <!-- <div *ngIf="ticket.status == statuses.Pending">
              <div class="ticket-gist" *ngIf="ticket.estimatedWorkTime && ticket.estimatedWorkTime.length != 0">
                <div class="gist-icon">
                  <img src="/assets/img/hours_icon.png">
                </div>
                <div class="gist-text">
                  <div>Estimated work time:</div>
                  <div>{{moment(ticket.estimatedWorkTime).toNow(true)}}</div>
                </div>
              </div>
              <div class="ticket-gist" *ngIf="!ticket.estimatedWorkTime || ticket.estimatedWorkTime.length == 0">
                <div class="gist-icon">
                  <img src="/assets/img/messagesIconGrey.png">
                </div>
                <div class="gist-text">
                  <div>A message was sent to tenant</div>
                </div>
              </div>
            </div> -->
            <!-- <div *ngIf="ticket.status == statuses.Done || ticket.status == statuses.Resolved" class="ticket-gist">
              <div class="gist-icon">
                <img src="/assets/img/v_icon-big.png">
              </div>
              <div class="gist-text">
                <div *ngIf="ticket.vendor">
                  <b>Vendor:</b>
                  <a [routerLink]="['/vendors', { searchQuery: ticket.vendor.firstName + ' ' + ticket.vendor.lastName }]">{{ticket.vendor.firstName + ' ' + ticket.vendor.lastName}}</a>
                </div>
                <div *ngIf="!ticket.vendor">
                  <b *ngIf="ticket.status == statuses.Done || ticket.status == statuses.Resolved">{{ticket.lastUpdateMsg | slice: 27 : 50 }}   </b>
                   <b>{{personWhoFix}}</b> 
                </div>
                <div *ngIf="ticket.lastUpdateDate">Fixed at {{ticket.lastUpdateDate | date}}</div>
              </div>
            </div> -->
          </div>
        </div>
        <div class="ticket-details" [ngClass]="{'hide-details': !ticket.showDetails}">
          <div class="ticket-left-pane">
            <div *ngIf="ticket.merged" class="merged">
              <div class="left-icon">
                <img src="/assets/img/mergeTicketsIcon.png">
              </div>
              <div class="right-content">
                <div class="merged-label">Merged</div>
                <div class="merged-ticket" *ngFor="let apt of ticket.apartments">
                  <div>{{apt}}</div>
                </div>
                <div class="merged-seperate">
                  <a (click)="seperateTickets(ticket.key)">Seperate</a>
                </div>
              </div>
            </div>
              <div *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance')" class="joined-tenants">
                  <div class="left-icon">
                      <img class="open-edit-title-and-subtitle" src="assets/img/pencil.png">
                      <!--openUserData(tenant);   -->
                  </div>
                  <div class="right-content margin-top--7px">
                    {{ticket.TicketTitle}} ,  {{ticket.TicketSubTitle}}
                    <div *ngIf="editTitleLabel(ticket.status)" style="color: #00b8a0; display: inline; cursor: pointer;" (click)="LoadCategoriesdialog(ticket);">(edit)</div>
                    <div *ngIf="!editTitleLabel(ticket.status)" style="color: #909090; display: inline;">(edit)</div>
                  </div>
                </div> 
            <div *ngIf="show == 'Location Manager'" class="joined-tenants">
              <div class="left-icon">
                <img src="/assets/img/mergeTicketsIcon.png"> 
              </div>
              <div class="right-content">
                <div class="joined-tenants-label">Joined Tenants</div>
                <div class="joined-tenants-holder">
                  <div class="joined-tenant" *ngFor="let tenant of (ticket.joinedPeople | slice:0:5)">
                    <img [src]="tenant.profileUrl" [alt]="tenant.firstName + ' ' + tenant.lastName">
                  </div>
                  <div class="more-tenants" *ngIf="ticket.joinedPeople?.length > 6">+{{ticket.joinedPeople.length - 6}}</div>
                </div>
              </div>
            </div>
            <div class="added-details">
              <div class="left-icon">
                <img src="/assets/img/info.png">
              </div>
              <div class="right-content">
                <div class="added-details-label">Added Details</div>
                <div *ngIf="translateTrueOrFalse(ticket.approvedEnteringTheApartment)" class="unattended-entrance">Unattended entrance: 
                    <div style="color: #00b8a0; display: inline;">{{translateTrueOrFalse(ticket.approvedEnteringTheApartment)}}</div>
                </div>
                <div *ngIf="translateTrueOrFalse(ticket.petOwner)" class="unattended-entrance">Pets:
                    <div style="color: #00b8a0; display: inline;"> {{translateTrueOrFalse(ticket.petOwner)}}</div>
                </div>
                <br />
                <!-- <a>{{ ticket.tenantFullName}} : </a>&nbsp;
                <div class="mainProblemDetail">{{ticket.TicketDecription}}</div> -->
                <div *ngFor="let info of ticket.moreInfo">
                  <a *ngIf="info.body != 'TICKET-DONE'">{{info.name}}:</a>&nbsp;
                  <div *ngIf="info.body != 'TICKET-DONE'" class="mainProblemDetail">{{info.body}}</div>
                  <!-- <a>{{info.name}}:</a>&nbsp; 
                  <div class="mainProblemDetail">{{info.body}}</div>  -->
                </div>
              </div>
            </div>
            <div class="more-info-input">
              <div class="left-icon">
                <img src="/assets/img/editIcon.png">
              </div>
              <div class="right-content">
                <textarea rows="4" (keyup.enter)="addMoreInfo($event, ticket._id)" placeholder="Write more information here"></textarea>
              </div>
            </div>
            <div *ngIf="(user$ |async)?.viewPermissions?.includes('Messages')" class="ticket-messages">
              <div class="left-icon">
                <img src="/assets/img/messagesIconGrey.png">
              </div>
              <div class="right-content">
                <b>No Messages Yet
                  <a *ngIf="(user$ |async)?.actionPermissions?.includes('Messages')" (click)="navigateToChatWithTenant(ticket.joinedPeople[0], ticket.joinedPeople[0].apartmentName)">Open Chat</a>
                </b>
              </div>
            </div>
          </div>
          <div class="ticket-middle-pane">
            <div class="left-icon">
              <img src="/assets/img/photoIcon.png">
            </div>
            <div class="middle-content">
              <div class="pictures-header">
                <div class="photos-label">Photos</div>
                <app-image-upload #imageUpload (imageUploaded)="addImageToTicket(ticket, $event)"></app-image-upload>
                <div class="form-item-add-input add-photo clickable" (click)="imageUpload.clickFolder('maintenance/tickets/'+ticket._id+'/manager',false)">
                  <div class="plus">
                    <div class="line"></div>
                    <div class="line"></div>
                  </div>
                  <div class="add-input-label">Add photo</div>
                </div>
              </div>
              <div class="pictures-holder" *ngIf="ticket.currentPhoto">
                <!-- <div class="main-picture">
                  <img [src]="ticket.currentPhoto">
                </div> -->
                <div class="pictures-list">
                  <div *ngFor="let photo of ticket.mainImg">
                  <span >{{photo.description}}</span>
                  <span *ngIf="photo.size > 0 && (ticket.mainImg.length === 1 || photo.id === 1) " class="photoSizeText" style="top: 33%;">+{{photo.size}} <br> more </span>
                  <span *ngIf="photo.size > 0 && ((photo.id === 3 && ticket.mainImg.length === 2) || (photo.id === 2 && ticket.mainImg.length > 1))" class="photoSizeText" style="top: 55%;">+{{photo.size}} <br> more </span>
                  <span *ngIf="photo.size > 0 && (photo.id === 3 && ticket.mainImg.length === 3)" class="photoSizeText" style="top: 77%;">+{{photo.size}} <br> more </span>
                  <div *ngIf="photo.url.slice(-3) == 'pdf'">
                      <a href="{{photo.url}}" target="_blank">
                          <img src="/assets/img/file_64.png" style="width: initial;">
                      </a> 
                  </div>
                  <div *ngIf="photo.url.slice(-3) != 'pdf'">
                      <img [src]="photo.url" class="clickable" (click)="showGallery(ticket,photo.id);open(0)">
                  </div>
                  </div>
                </div>
              </div>
              <div class="no-pictures" *ngIf="ticket.mainImg.length == 0">
              </div>
            </div>
          </div>
          <div class="ticket-right-pane">
            <!-- <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && ticket.status === 'Open'"
              class="c2-cancel-button" (click)="vendorRequired(ticket)">
              VENDOR REQUIRED
            </button> -->
            <div *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && (ticket.status === 'Open' || ticket.status === 'In_Progress' || ticket.status === 'Vendor_Assigned' ) && jusers">
            <div class="staff-members-list c2-list" style="display:flex;">
                <label for="staffIn" class="C2-dd-label" style="line-height: 37px;">Assigned:</label>
                <div  id="staffIn" class="selector" style="border-left: none;" (click)="dropDown.style.display = 'block'">
                  <ng-container *ngIf="ticket.selectedJanitor">
                      {{ticket.selectedJanitor.firstName}} {{ticket.selectedJanitor.lastName}}
                  </ng-container>
                  <ng-container *ngIf="!ticket.selectedJanitor">
                    {{jusers.length}} staff members
                  </ng-container>
                </div>
                <div class="drop-down" #dropDown>
                  <div class="list-item" *ngFor="let user of jusers" (click)="selectJanitor(user,ticket) && dropDown.style.display = 'none'"
                    [ngClass]="{selected: false}">
                    {{user.firstName}} {{user.lastName}}
                  </div>
                </div>
              </div> 
              <button *ngIf="ticket.selectedJanitor" class="c2-cancel-button" (click)="AssignInternal(ticket)" style="margin-top: 10px; width: 140%; margin-left: -60%;">ASSIGN WORKER</button>
            </div>
            <button *ngIf="false" class="c2-cancel-button" (click)="imgGallery = true" style="margin-top: 10px; width: 140%; margin-left: -60%;">Video</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-dialog class="set-time-dialog" *ngIf="show == 'Janitor' && clickedTicket" [greenHeader]="true" [visible]="true" [header]="'Set estimate work time for ' + clickedTicket.ticketNumber"
  (visibleChange)="modalVisibiltyChanged($event)">
  <div class="set-time-dialog">
    <div *ngIf="!clickedTicket.approvedEnteringTheApartment" class="set-time-label">Note: This tenants asked to schedule a time frame for visiting</div>
    <div class="choose-date">
      <div class="left-icon">
        <img src="/assets/img/calander_icon.png">
      </div>
      <div class="date-options">
        <div class="today" [ngClass]="{'choosen': clickedTicket.date == 'today'}" (click)="clickedTicket.date = 'today'">
          <div>Today</div>
          <div>{{moment().format('MM/DD/YY')}}</div>
        </div>
        <div class="tomorrow" [ngClass]="{'choosen': clickedTicket.date == 'tomorrow'}" (click)="clickedTicket.date = 'tomorrow'">
          <div>Tomorrow</div>
          <div>{{moment().add(1, 'days').format('MM/DD/YY')}}</div>
        </div>
        <div class="monday" *ngIf="moment().day() == 5" [ngClass]="{'choosen': clickedTicket.date == 'monday'}" (click)="clickedTicket.date = 'monday'">
          <div>Monday</div>
          <div>{{moment().add(2, 'days').format('MM/DD/YY')}}</div>
        </div>
        <div class="manual" [ngClass]="{'choosen': clickedTicket.date == 'manual'}" (click)="clickedTicket.date = 'manual'">
          <div>Set</div>
          <div>Manually</div>
        </div>
      </div>
      <div class="date-picker">
        <datepicker [(date)]="datepicker" [historyDisabled]="true" [width]="'97px'" [height]="'30px'" [format]="'DD MMM YY'" [ngStyle]="{display: clickedTicket.date == 'manual' ? 'block' : 'none'}"></datepicker>
      </div>
    </div>
    <div class="choose-time">
      <div class="left-icon">
        <img src="/assets/img/hours_icon.png">
      </div>
      <div class="set-time">
        <div class="select-hours">
          <select id="selectEstHour">
            <option [value]="hour" *ngFor="let hour of hours">{{hour}}</option>
          </select>
        </div>
        <div class="select-minutes">
          <select name="" id="selectEstMinute">
            <option [value]="minute" *ngFor="let minute of minutes">{{minute}}</option>
          </select>
        </div>
      </div>
    </div>
    <div *ngIf="clickedTicket.error" class="form-item-error">
      {{clickedTicket.error}}
    </div>
    <div class="set-button">
      <button class="c2-ok-button" (click)="setEstTime()">SET</button>
    </div>
  </div>
</app-dialog>
<app-dialog class="choose-vendor-dialog" *ngIf=" (show == 'Location Manager' || show == 'Regional Manager') && clickedTicket" [size]="'large'" [visible]="true"
  [header]="'EDIT AUCTION FOR ' + clickedTicket.ticketNumber + ' : ' + clickedTicket.TicketTitle + ' , ' + clickedTicket.TicketSubTitle" (visibleChange)="modalVisibiltyChanged($event)">
  <div class="choose-vendor">
    <div class="right-pane">
      <div class="pane-header">
        TIME FRAME FOR FIXING
      </div>
      <div class="time-type">
        <div class="full-day clickable" (click)="chooseVendor.timeType = 'ASAP'; clearDateChoices();">
          <div class="c2-radio" [ngClass]="{'checked': chooseVendor.timeType == 'ASAP'}"></div> As Soon As Possible
        </div>
        <div class="time-frame clickable" (click)="chooseVendor.timeType = 'TIMEFRAME'">
          <div class="c2-radio" [ngClass]="{'checked': chooseVendor.timeType == 'TIMEFRAME'}"></div> Time Frame
        </div>
      </div>
      <div class="pick-date">
        <div class="single-day" *ngIf="chooseVendor.timeType == 'ASAP'">
        </div>
        <div class="time-range" *ngIf="chooseVendor.timeType == 'TIMEFRAME'">
          <div class="start">
            <div class="start-label">Starts at</div>
            <div class="pickers">
              <datepicker [(date)]="chooseVendor.fromDay" [historyDisabled]="true" [width]="'97px'" [height]="'30px'" [format]="'DD MMM YY'"></datepicker>
              <select id="" [(ngModel)]="chooseVendor.fromHour">
                <option [value]="hour" *ngFor="let hour of hours">{{hour}}</option>
              </select>
              <div>:</div>
              <select class="last-select" id="" [(ngModel)]="chooseVendor.fromMinute">
                <option [value]="minute" *ngFor="let minute of minutes">{{minute}}</option>
              </select>
            </div>
          </div>
          <div class="end">
            <div class="end-label">Ends at</div>
            <div class="pickers">
              <datepicker [(date)]="chooseVendor.toDay" [historyDisabled]="true" [width]="'97px'" [height]="'30px'" [format]="'DD MMM YY'"></datepicker>
              <select id="" [(ngModel)]="chooseVendor.toHour">
                <option [value]="hour" *ngFor="let hour of hours">{{hour}}</option>
              </select>
              <div>:</div>
              <select class="last-select" id="" [(ngModel)]="chooseVendor.toMinute">
                <option [value]="minute" *ngFor="let minute of minutes">{{minute}}</option>
              </select>
            </div>
          </div>
        </div>
        <div *ngIf="chooseVendorErrors && chooseVendorErrors.timeType == 'TIMEFRAME' && chooseVendorErrors.timeRangeError" class="time-error">
          {{chooseVendorErrors.timeRangeError}}
        </div>
      </div>
      <div class="vendors-to-request">
        <div class="vendors-to-request-label">CATEGORIES</div>
        <!-- VENDORS TO REQUEST -->
        <div class="vendors-box">
          <div class="vendors-search">
            <div class="choosen-vendors" *ngFor="let vendor of this.chooseVendor.choosenVendors; let choosenVendorIndex = index">
              {{vendor.firstName}} {{vendor.lastName}}
              <span class="clickable" (click)="removeVendor(choosenVendorIndex)">&times;</span>
            </div>
          </div>
          <div class="vendors-list">
            <div class="loading-vendors" *ngIf="loadingVendors">Loading ...</div>
            <div class="vendor-type" *ngFor="let group of vendors">
              <div class="type-header">
                <div class="type-label">{{group.type}}</div>
                <!-- <div class="all-type">All {{group.type}}s</div> -->
                <div class="c2-check-box" (click)="checkGroup(group)">
                  <div *ngIf="group.checked" class="c2-check-box-checked"></div>
                </div>
              </div>
              <div class="type-vendors">
                <div class="vendor" *ngFor="let vendor of group.vendors">
                  <div class="vendor-name">{{vendor.firstName}} {{vendor.lastName}}</div>
                  <div class="c2-check-box" (click)="checkVendor(vendor, group)">
                    <div *ngIf="vendor.checked" class="c2-check-box-checked"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div style="display: flex;">
      <!-- <div class="offer-deadline" style="width: 50%;">
        <div class="offer-deadline-label">OFFER DEADLINE</div>
        <div class="pickers">
          <datepicker [(date)]="chooseVendor.offerDeadlineDay" [historyDisabled]="true" [width]="'97px'" [height]="'30px'" [format]="'DD MMM YY'"></datepicker>
          <select id="" [(ngModel)]="chooseVendor.offerDeadlineHour">
            <option [value]="hour" *ngFor="let hour of hours">{{hour}}</option>
          </select>
          <div>:</div>
          <select class="last-select" [(ngModel)]="chooseVendor.offerDeadlineMinute" id="">
            <option [value]="minute" *ngFor="let minute of minutes">{{minute}}</option>
          </select>
        </div>
      </div> -->
      <div style="width: 50%;">
        <div class="other-category">{{otherCategory}}</div>
        <input type="text" name="v" id="1q" class="other-category-input" *ngIf="otherCategory != null">
      </div>
      </div>
      <div class="send-to-vendors">
        <button class="c2-ok-button" (click)="sendVendorAuction(clickedTicket)" [ngClass]="{loading: sendingToVendors}" *ngIf="clickedTicket.numberOfOffersPerTicket === 0 && clickedTicket.status === 'Auction_Created'">SAVE AND CLOSE</button>
        <button class="c2-ok-button" (click)="sendVendorAuction(clickedTicket)" [ngClass]="{loading: sendingToVendors}" *ngIf="clickedTicket.numberOfOffersPerTicket === 0 && clickedTicket.status === 'Vendor_Required'">SUBMIT AUCTION</button>
        <button class="c2-ok-button" (click)="clickedTicket = null" [ngClass]="{loading: sendingToVendors}" *ngIf="clickedTicket.numberOfOffersPerTicket > 0 ">CLOSE</button>
        <button class="c2-cancel-button" (click)="clickedTicket = null" [ngClass]="{loading: sendingToVendors}" *ngIf="clickedTicket.status === 'Vendor_Required'">CLOSE</button>
        <!--  (click)="sendToVendors()" -->
        <button class="c2-cancel-button" (click)="cancelAuction(clickedTicket)" [ngClass]="{loading: sendingToVendors}" *ngIf="clickedTicket.status === 'Auction_Created'">CANCEL AUCTION</button>
      </div>
    </div>
    <div class="left-pane">
      <div class="pane-header">TICKET DETAILS</div>
      <div class="ticket-details">
        <div class="details-header">
          {{clickedTicket.TicketTitle}}, {{clickedTicket.MaintenanceAddress}}
        </div>
        <div class="details-body">
          <!-- <div *ngFor="let info of clickedTicket.moreInfo">
            <a>{{info.name}}:</a>&nbsp;
            <span>{{info.body}}</span>
          </div> -->
          <div>
              <a>{{clickedTicket.tenantFullName}}:</a>&nbsp;
              <span>{{clickedTicket.TicketDecription}}</span>
            </div>
        </div>
      </div>
      <div class="photos">
        <div class="photos-header">
          <div class="photos-label">PHOTOS</div>
        </div>
        <div class="photos-holder">
          <img *ngFor="let photo of (imgGalleryArray | slice:0:3)" [src]="photo.url">
        </div>
        <div class="photos-holder">
            <img *ngFor="let photo of (imgGalleryArray | slice:3:6)" [src]="photo.url">
          </div>
          <div class="photos-holder">
              <img *ngFor="let photo of (imgGalleryArray | slice:6:9)" [src]="photo.url">
            </div>
      </div>
    </div>
  </div>
</app-dialog>
<app-dialog class="check-offers-dialog" *ngIf="clickedTicketEditOffers" [greenHeader]="false" [visible]="true" [size]="'huge'"
  [header]="'VENDORS OFFERS ' + vendorOffersTicket.ticketNumber + ' : ' + vendorOffersTicket.TicketTitle + ' , ' + vendorOffersTicket.TicketSubTitle " (visibleChange)=" clickedTicketEditOffers = false">
  <!-- (visibleChange)="modalVisibiltyChanged($event)" -->
  <div class="payments">
    <div class="table-header lease-row">
      <div class="col-1 tab-right">VENDOR NAME</div>
      <div class="col-2 tab-right15">EARLIEST AVAILABILITY</div>
      <div class="col-3">PRICE</div>
      <div class="col-4">ATTACHMENTS</div>
      <div class="col-5">RATING & REVIEWS</div>
      <div class="col-6"> &nbsp; </div>
    </div>
  </div>
  <div class="item" *ngFor="let offer of vendorOffers">
    <div class="item-header lease-row" (click)="offer.expand = !offer.expand" *ngIf="(vendorOffersTicket.status === 'Vendor_Assigned' && offer.OfferStatus === 'Win') || vendorOffersTicket.status !== 'Vendor_Assigned'">
      <div class="col-1"><span>{{offer.vendorName}}</span></div>
      <div class="col-2 tab-right"> {{moment(offer.ArrivalDate).format('MMM DD, YYYY hh:mm A')}}</div>
      <div class="col-3">${{offer.price}}</div>
      <div class="col-2 tab-right-10"><img *ngIf="vendorOffersTicket.mainImg.length > 0 " src="/assets/img/mergeTicketsIcon.png"></div>
      <div class="col-5">
        <!-- {{offer.vendorRating}} -->
        <div style="display: flex;">
            <div *ngFor="let gold of getArray(offer.vendorRating); let goldIndex = index">
              <img src="/assets/img/star_gold.png" style="width: 12px; height: 12px; margin-top: 24px;">
            </div>
            <div *ngFor="let grey of getArray(5 - offer.vendorRating); let goldIndex = index">
              <img src="/assets/img/star_grey.png" style="width: 12px; height: 12px; margin-top: 24px;">
            </div>
            <div>
                &nbsp;({{offer.vendorReviews}})
            </div>
        </div>
      </div>
      <div class="col-6" (click)="offer.expand = !offer.expand">
        <button class="c2-ok-button" (click)="assignVendor(offer)" *ngIf="vendorOffersTicket.status !== 'Vendor_Assigned'"> Assign Vendor</button>
        <span *ngIf="vendorOffersTicket.status === 'Vendor_Assigned' && offer.OfferStatus === 'Win'">ASSIGNED</span>
      </div>
  </div>
    <div class="item-body" [ngClass]="{'hidden-body': !offer.expand}">
      <div class="left-panel">
          <div class="added-details">
            <div class="left-icon">
              <img class="icon" src="/assets/img/info.png">
            </div>
            <div class="right-content">
              <div class="added-details-label">Added Details</div>
              <a>{{offer.vendorName}} : </a>&nbsp;
              <div class="mainProblemDetail">{{offer.ResponseComments}}</div>
            </div>
          </div>
          <div *ngIf="(user$ |async)?.viewPermissions?.includes('Messages')" class="ticket-messages">
            <div class="left-icon">
              <img src="/assets/img/messagesIconGrey.png">
            </div>
            <div class="right-content">
              <b>No Messages Yet
                <a *ngIf="(user$ |async)?.actionPermissions?.includes('Messages')" (click)="navigateToChatWithTenant(ticket.joinedPeople[0], ticket.joinedPeople[0].apartmentName)">Open Chat</a>
              </b>
            </div>
          </div>
        </div>
        <div class="middle-panel">
            <div class="left-icon">
                <img src="/assets/img/mergeTicketsIcon.png">
              </div>
          <div class="middle-content">
            <div class="pictures-header">
              <div class="photos-label">ATTACHMENTS</div>
            </div>
            <div class="pictures-holder" *ngIf="imgGalleryArray.length > 0">
              <div class="pictures-list">
                <div *ngFor="let photo of (imgGalleryArray | slice:0:1)">
                <span *ngIf="imgGalleryArray.length > 1" class="photoSizeTextVendor">+{{imgGalleryArray.length-1}} <br> more </span>
                <img style="width: 100px; height: 85px;" [src]="photo.url" class="clickable" (click)="showGallery(vendorOffersTicket,4); imgGallery = true;">
                </div>
                <div *ngFor="let photo of imgGalleryPdf">
                    <a href="{{photo.url}}" target="_blank">{{photo.name}}</a> 
              </div>
              </div>
            </div>
            <div class="no-pictures" *ngIf="imgGalleryArray.length == 0">
            </div>
          </div>
        </div>
        <div class="right-panel">
          <div class="availability">
            <div class="left-icon">
                <img class="icon" src="/assets/img/event_icon.png">
              </div>
              <div class="right-content">
                <div style="margin-bottom:2%;">AVAILABILITY</div>
                <div style="margin-bottom:2%;" [ngClass]="vendorOffersTicket.status === 'Vendor_Assigned' && offer.OfferStatus != 'Win' ? 'CB-Disabled' : 'CB-Enabled'">
                    <input type="radio" value="1" name="time" (change)="fillTimeToAssign('1')" [disabled]="vendorOffersTicket.status === 'Vendor_Assigned' ? true : false"  [checked]="vendorOffersTicket.status === 'Vendor_Assigned' && offer.OfferStatus === 'Win' ? true : false"> 
                     {{moment(offer.ArrivalDate).format('MMM DD, YYYY hh:mm A')}}
                  </div>
                <!-- <div style="margin-bottom:2%;" [ngClass]="vendorOffersTicket.status === 'Vendor_Assigned' ? 'CB-Disabled' : 'CB-Enabled'">
                    <input type="radio" value="2" name="time" (change)="fillTimeToAssign('2')" [disabled]="vendorOffersTicket.status === 'Vendor_Assigned' ? true : false"> 
                    {{moment(offer.ArrivalDate+133000000).format('MMM DD, YYYY hh:mm A')}}
                  </div>
                <div style="margin-bottom:2%;" [ngClass]="vendorOffersTicket.status === 'Vendor_Assigned' ? 'CB-Disabled' : 'CB-Enabled'"> 
                    <input type="radio" value="3" name="time" (change)="fillTimeToAssign('3')" [disabled]="vendorOffersTicket.status === 'Vendor_Assigned' ? true : false"> 
                    {{moment(offer.ArrivalDate+333000000).format('MMM DD, YYYY hh:mm A')}}
                  </div> -->
                <div *ngIf="timeToAssign == 0" style="color:red;"> PLEASE CHOOSE AVAILABILITY</div>
                <button *ngIf="(user$ |async)?.actionPermissions?.includes('Maintenance') && vendorOffersTicket.status === 'Vendor_Assigned' && offer.OfferStatus === 'Win'" class="c2-cancel-button" (click)="cancelVendorAssignment(vendorOffersTicket,offer)" 
                style="margin-top: 110px; margin-left: 35px;"> CANCEL OFFER</button>
              </div>
            </div>
        </div>
    </div>
  </div>

  <div class="col-6">
      <button class="c2-ok-button" (click)="clickedTicketEditOffers = !clickedTicketEditOffers"> Close</button>
    </div>
</app-dialog>
<app-dialog class="rating-vendors-dialog" *ngIf="rateShow" [greenHeader]="false" visible="true" size="medium" 
[header]="'Ticket ' + rateTicket.ticketNumber + ' : ' + rateTicket.TicketTitle + ' , ' + rateTicket.TicketSubTitle "
  (visibleChange)="rateShow = false" [removePdding]="true">
  <!-- (visibleChange)="modalVisibiltyChanged($event) -->
  <div style="padding: 0 20px 20px 20px; margin-top: -5px;">
      <mat-tab-group mat-stretch-tabs>
          <!--  [selectedIndex]="1" -->
          <mat-tab label="CLOSE" >
              <div>
                  <div class="add-note-label" style="margin-top: 20px;">Add note(optional)</div>
                  <textarea class="note-text-area" #textboxClose></textarea>
                  <div class="pictures-header" style="margin-top: 10px;">
                      <app-image-upload #imageUploadClose (imageUploadedAndName)="addImageToTicket(rateTicket, $event)" (uploadProgressChange) = "uploadProgress($event)"></app-image-upload>
                      <div class="form-item-add-input add-photo clickable" (click)="imageUploadClose.clickFolder('maintenance/tickets/'+rateTicket._id+'/closingfiles/manager',false)">
                        <div class="plus">
                          <div class="line"></div>
                          <div class="line"></div>
                        </div>
                        <div class="add-input-label">Attachments</div>
                      </div>
                  </div>
                  <div *ngFor="let file of rateTicket.closeAttachments">
                      <div style="font-size: 13px; margin-left: 21px; color: #909090">{{file.name}}, uploaded: 
                        <a [href]="file.url" target="_blank" *ngIf="!file.edit">{{file.fileName}}.{{file.fileEnd}}</a>
                        <mat-form-field *ngIf="file.edit">
                            <input matInput placeholder="File name" [(ngModel)]="file.rename">
                          </mat-form-field>
                      <mat-icon class="clickable" *ngIf="!file.edit" (click)="file.edit = !file.edit" style="position: absolute; right: 0px;">create</mat-icon>

                      <mat-icon class="clickable" *ngIf="file.edit" (click)="renameAttachments(file)" style="position: absolute; margin-top: 10px;">check</mat-icon>
                      <mat-icon class="clickable" *ngIf="file.edit" (click)="undoRenameAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 25px;">undo</mat-icon>
                      <mat-icon class="clickable" *ngIf="file.edit" (click)="removeAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 50px;">delete_outline</mat-icon>
                    </div>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="uploadProgresspercentage" *ngIf="uploadProgresspercentage !== 0"></mat-progress-bar>
                  <mat-divider style=" margin-top: 10px;"></mat-divider>
                  <div class="pictures-header" style="margin: 10px 0 2px 0px;">
                      <div class="form-item-add-input add-photo clickable" (click)="addCost()">
                        <div class="plus">
                          <div class="line"></div>
                          <div class="line"></div>
                        </div>
                        <div class="add-input-label">Cost</div>
                      </div>
                  </div>
                  <div *ngIf="rateTicket.costList">
                      <div *ngFor="let cost of rateTicket.costList" style="display:flex;">
                          <mat-form-field style="width: 30%; font-size: 13px;">
                              <input matInput placeholder="Amount" type="number" [disabled]="!cost.edit" class="example-right-align">
                              <span matPrefix> 
                                <mat-icon *ngIf="cost.edit" style="color:#00b8a0">attach_money</mat-icon>
                                  <mat-icon  *ngIf="!cost.edit">attach_money</mat-icon>
                              &nbsp;</span>
                          </mat-form-field>
                          <mat-form-field style="width: 65%; margin-left: 20px; font-size: 13px;" >
                              <input matInput placeholder="Note for amount" [disabled]="!cost.edit">
                          </mat-form-field>
                          <mat-icon class="clickable" *ngIf="cost.edit"  (click)="cost.edit = !cost.edit" style="color:#00b8a0; margin-top: 10px;">check</mat-icon>
                          <mat-icon class="clickable" *ngIf="cost.edit"  (click)="removeCost(cost)" style="margin-top: 10px; color: #909090;">delete_outline</mat-icon>
                          <mat-icon class="clickable" *ngIf="!cost.edit" (click)="cost.edit = !cost.edit" style="margin-top: 10px; color: #909090;">create</mat-icon>
                          <mat-icon style="color:white;" *ngIf="!cost.edit">clear</mat-icon>
                      </div>
                  </div>
                  <button class="c2-ok-button" (click)="searchQuery = null" style="margin-top: 10px;">SAVE FOR LATER</button>
                  <button class="c2-cancel-button" (click)="searchQuery = null" style="margin-top: 10px;">MARK AS DONE</button>
              </div>
          </mat-tab>
          <mat-tab label="RATE & REVIEW">
              <p style="text-align: center; margin-bottom: 0px;"><span class="CB-Enabled">ASSIGNED VENDOR: </span>{{rateOffer.companyName}}</p>
              <div class="vendor-rating" *ngIf="isHoverMode">
                  <div *ngFor="let gold of getArray(rating); let goldIndex = index" (mouseover)='changeRating(goldIndex)' 
                  (click)='clickChangeRating(goldIndex)' (mouseleave)='changeRatingLeave()'>
                    <img src="/assets/img/star_gold.png">
                  </div>
                  <div *ngFor="let grey of getArray(5 - rating); let goldIndex = index" (mouseover)='changeRating(goldIndex + rating + 1)'
                    (click)='clickChangeRating(goldIndex)' (mouseleave)='changeRatingLeave()'>
                    <img src="/assets/img/star_grey.png">
                  </div>
                </div>
                <div class="vendor-rating" *ngIf="!isHoverMode">
                  <div *ngFor="let gold of getArray(nonHoverRating); let goldIndex = index" (mouseover)='toggleHover()' (mouseleave)='toggleLeave()'
                    (click)='clickChangeRating(goldIndex)'>
                    <img src="/assets/img/star_gold.png">
                  </div>
                  <div *ngFor="let grey of getArray(5 - nonHoverRating); let goldIndex = index" (mouseover)='toggleHover()' (mouseleave)='toggleLeave()'
                   (click)='clickChangeRating(goldIndex)'>
                    <img src="/assets/img/star_grey.png">
                  </div>
                </div>
                <div class="add-note-label"> ADD REVIEW(OPTIONAL)</div>
                <textarea class="note-text-area" #textboxRate></textarea>
                <div class="set-button">
                  <button class="c2-ok-button" (click)="rateVendor(textboxRate.value)" [ngClass]="{loading: ratingLoading}" style="margin-top: 10px;">SUBMIT</button>
                  <a href="mailto:support@c2communities.com?subject=Letting you know about {{rateOffer.companyName}} &body=" style="font-size: 12px; margin-left: 30%;" >Contact us about this vendor</a>
                </div>
          </mat-tab>
        </mat-tab-group>
  </div>
</app-dialog>
<app-dialog class="rating-vendors-dialog" *ngIf="fixedShow" [greenHeader]="false" visible="true" size="medium" 
[header]="'Ticket ' + rateTicket.ticketNumber + ' : ' + rateTicket.TicketTitle + ' , ' + rateTicket.TicketSubTitle "
  (visibleChange)="fixedShow = false" [removePdding]="true">
  <div style="padding: 0 20px 20px 20px; margin-top: -5px;">
    <div>
        <div class="add-note-label" style="margin-top: 20px;">Add note(optional)</div>
        <textarea class="note-text-area" #textbox></textarea>
      <div class="pictures-header" style="margin-top: 10px;">
          <app-image-upload #imageUploadClose (imageUploaded)="addImageToTicket(rateTicket, $event)"></app-image-upload>
          <div class="form-item-add-input add-photo clickable" (click)="imageUploadClose.clickFolder('maintenance/tickets/'+rateTicket._id+'/closingfiles/manager',false)">
            <div class="plus">
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="add-input-label">Attachments</div>
          </div>
      </div>
      <div *ngFor="let file of rateTicket.closeAttachments">
          <div style="font-size: 13px; margin-left: 21px; color: #909090">{{file.name}}, uploaded: 
            <a [href]="file.url" target="_blank" *ngIf="!file.edit">{{file.fileName}}.{{file.fileEnd}}</a>
            <mat-form-field *ngIf="file.edit">
                <input matInput placeholder="File name" [(ngModel)]="file.rename">
              </mat-form-field>
          <mat-icon class="clickable" *ngIf="!file.edit" (click)="file.edit = !file.edit" style="position: absolute; right: 0px;">create</mat-icon>

          <mat-icon class="clickable" *ngIf="file.edit" (click)="renameAttachments(file)" style="position: absolute; margin-top: 10px;">check</mat-icon>
          <mat-icon class="clickable" *ngIf="file.edit" (click)="undoRenameAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 25px;">undo</mat-icon>
          <mat-icon class="clickable" *ngIf="file.edit" (click)="removeAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 50px;">delete_outline</mat-icon>
        </div>
      <mat-progress-bar mode="determinate" [value]="uploadProgresspercentage" *ngIf="uploadProgresspercentage !== 0"></mat-progress-bar>
      <mat-divider style=" margin-top: 10px;"></mat-divider>
      <div class="pictures-header" style="margin: 10px 0 2px 0px;">
          <div class="form-item-add-input add-photo clickable" (click)="addCost()">
            <div class="plus">
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="add-input-label">Cost</div>
          </div>
      </div>
      <div *ngIf="rateTicket.costList">
          <div *ngFor="let cost of rateTicket.costList" style="display:flex;">
              <mat-form-field style="width: 30%; font-size: 13px;">
                  <input matInput placeholder="Amount" type="number" [disabled]="!cost.edit" class="example-right-align">
                  <span matPrefix> 
                    <mat-icon *ngIf="cost.edit" style="color:#00b8a0">attach_money</mat-icon>
                      <mat-icon  *ngIf="!cost.edit">attach_money</mat-icon>
                  &nbsp;</span>
              </mat-form-field>
              <mat-form-field style="width: 65%; margin-left: 20px; font-size: 13px;" >
                  <input matInput placeholder="Note for amount" [disabled]="!cost.edit">
              </mat-form-field>
              <mat-icon class="clickable" *ngIf="cost.edit"  (click)="cost.edit = !cost.edit" style="color:#00b8a0; margin-top: 10px;">check</mat-icon>
              <mat-icon class="clickable" *ngIf="cost.edit"  (click)="removeCost(cost)" style="margin-top: 10px; color: #909090;">delete_outline</mat-icon>
              <mat-icon class="clickable" *ngIf="!cost.edit" (click)="cost.edit = !cost.edit" style="margin-top: 10px;">create</mat-icon>
              <mat-icon style="color:white;" *ngIf="!cost.edit">clear</mat-icon>
          </div>
      </div>
      <button class="c2-ok-button" (click)="searchQuery = null" style="margin-top: 10px;">SUBMIT</button>
      <button class="c2-cancel-button" (click)="fixedShow = false" style="margin-top: 10px;">CLOSE</button>
   </div>
  </div>
</app-dialog>
<app-dialog class="rating-vendors-dialog" *ngIf="ResolvedDoneShow" [greenHeader]="false" visible="true" size="medium" 
[header]="'Ticket ' + rateTicket.ticketNumber + ' : ' + rateTicket.TicketTitle + ' , ' + rateTicket.TicketSubTitle "
  (visibleChange)="ResolvedDoneShow = false" [removePdding]="true">
  <div style="padding: 0 20px 20px 20px; margin-top: -5px;">
      <mat-tab-group mat-stretch-tabs>
          <!--  [selectedIndex]="1" -->
          <mat-tab label="CLOSE">
              <div>
                  <div class="add-note-label" style="margin-top:20px;">Add note(optional)</div>
                  <textarea class="note-text-area" #textboxClose></textarea>
                  <div class="pictures-header" style="margin-top: 10px;">
                      <app-image-upload #imageUploadClose (imageUploaded)="addImageToTicket(rateTicket, $event)"></app-image-upload>
                      <div class="form-item-add-input add-photo clickable" (click)="imageUploadClose.clickFolder('maintenance/tickets/'+rateTicket._id+'/closingfiles/manager',false)">
                        <div class="plus">
                          <div class="line"></div>
                          <div class="line"></div>
                        </div>
                        <div class="add-input-label">Attachments</div>
                      </div>
                  </div>
                  <div *ngFor="let file of rateTicket.closeAttachments">
                      <div style="font-size: 13px; margin-left: 21px; color: #909090">{{file.name}}, uploaded: 
                        <a [href]="file.url" target="_blank" *ngIf="!file.edit">{{file.fileName}}.{{file.fileEnd}}</a>
                        <mat-form-field *ngIf="file.edit">
                            <input matInput placeholder="File name" [(ngModel)]="file.rename">
                          </mat-form-field>
                      <mat-icon class="clickable" *ngIf="!file.edit" (click)="file.edit = !file.edit" style="position: absolute; right: 0px;">create</mat-icon>

                      <mat-icon class="clickable" *ngIf="file.edit" (click)="renameAttachments(file)" style="position: absolute; margin-top: 10px;">check</mat-icon>
                      <mat-icon class="clickable" *ngIf="file.edit" (click)="undoRenameAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 25px;">undo</mat-icon>
                      <mat-icon class="clickable" *ngIf="file.edit" (click)="removeAttachments(file)" style="position: absolute; margin-top: 10px; margin-left: 50px;">delete_outline</mat-icon>
                    </div>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="uploadProgresspercentage" *ngIf="uploadProgresspercentage !== 0"></mat-progress-bar>
                  <mat-divider style=" margin-top: 10px;"></mat-divider>
                  <div class="pictures-header" style="margin: 10px 0 2px 0px;">
                      <div class="form-item-add-input add-photo clickable" (click)="addCost()">
                        <div class="plus">
                          <div class="line"></div>
                          <div class="line"></div>
                        </div>
                        <div class="add-input-label">Cost</div>
                      </div>
                  </div>
                  <div *ngIf="rateTicket.costList">
                      <div *ngFor="let cost of rateTicket.costList" style="display:flex;">
                          <mat-form-field style="width: 30%; font-size: 13px;">
                              <input matInput placeholder="Amount" type="number" [disabled]="!cost.edit" class="example-right-align">
                              <span matPrefix> 
                                <mat-icon *ngIf="cost.edit" style="color:#00b8a0">attach_money</mat-icon>
                                  <mat-icon  *ngIf="!cost.edit">attach_money</mat-icon>
                              &nbsp;</span>
                          </mat-form-field>
                          <mat-form-field style="width: 65%; margin-left: 20px; font-size: 13px;" >
                              <input matInput placeholder="Note for amount" [disabled]="!cost.edit">
                          </mat-form-field>
                          <mat-icon class="clickable" *ngIf="cost.edit"  (click)="cost.edit = !cost.edit" style="color:#00b8a0; margin-top: 10px;">check</mat-icon>
                          <mat-icon class="clickable" *ngIf="cost.edit"  (click)="removeCost(cost)" style="margin-top: 10px; color: #909090;">delete_outline</mat-icon>
                          <mat-icon class="clickable" *ngIf="!cost.edit" (click)="cost.edit = !cost.edit" style="margin-top: 10px;">create</mat-icon>
                          <mat-icon style="color:white;" *ngIf="!cost.edit">clear</mat-icon>
                      </div>
                  </div>
                  <button class="c2-ok-button" (click)="searchQuery = null" style="margin-top: 10px;">SAVE FOR LATER</button>
                  <button class="c2-cancel-button" (click)="searchQuery = null" style="margin-top: 10px;">MARK AS DONE</button>
              </div>
          </mat-tab>
          <mat-tab label="VIEW RATING & REVIEW" *ngIf="nonHoverRating !== 0">
              <div class="vendor-rating" *ngIf="isHoverMode">
                  <div *ngFor="let gold of getArray(rating); let goldIndex = index" (mouseover)='changeRating(goldIndex)' 
                  (click)='clickChangeRating(goldIndex)' (mouseleave)='changeRatingLeave()'>
                    <img src="/assets/img/star_gold.png">
                  </div>
                  <div *ngFor="let grey of getArray(5 - rating); let goldIndex = index" (mouseover)='changeRating(goldIndex + rating + 1)'
                    (click)='clickChangeRating(goldIndex)' (mouseleave)='changeRatingLeave()'>
                    <img src="/assets/img/star_grey.png">
                  </div>
                </div>
                <div class="vendor-rating" *ngIf="!isHoverMode">
                  <div *ngFor="let gold of getArray(nonHoverRating); let goldIndex = index" (mouseover)='toggleHover()' (mouseleave)='toggleLeave()'
                    (click)='clickChangeRating(goldIndex)'>
                    <img src="/assets/img/star_gold.png">
                  </div>
                  <div *ngFor="let grey of getArray(5 - nonHoverRating); let goldIndex = index" (mouseover)='toggleHover()' (mouseleave)='toggleLeave()'
                   (click)='clickChangeRating(goldIndex)'>
                    <img src="/assets/img/star_grey.png">
                  </div>
                </div>
                <div class="add-note-label">ADD REVIEW (OPTIONAL)</div>
                <textarea class="note-text-area" #textboxRate disabled></textarea>
                <div class="set-button">
                  <button class="c2-ok-button" (click)="rateVendor(textboxRate.value)" [ngClass]="{loading: ratingLoading}" style="margin-top: 10px;" disabled>SUBMIT</button>
                </div>
          </mat-tab>
          <mat-tab label="VIEW RATING & REVIEW" *ngIf="nonHoverRating === 0">
              <p style="text-align: center;margin: 95px;">not rated yet</p>
              <button class="c2-ok-button" (click)="searchQuery = null" style="margin-top: 10px;">Remaind tenant</button>
          </mat-tab>
        </mat-tab-group>
  </div>
</app-dialog>
<app-dialog *ngIf="showEditInfo" [visible]="true" size="medium" [header]="'Edit maintenance ticket category'" (visibleChange)="showEditInfo = false">
<div>
  <div class="form-item">
        <div class="dropdown-title-and-sub">
          <label for="mainCategory" class="C2-dd-label">Category:</label>
          <select id="mainCategory" class="width-50p" name="selectmake" [(ngModel)]="mainCategory">
              <option *ngFor="let category of categories" [ngValue]="category">{{category.proname}}</option>
          </select>
          <div>&nbsp; </div>
           <label for="subCategory" class="C2-dd-label">Type:</label>
           <select id="subCategory" class="width-50p" name="selectmodel" [(ngModel)]="subCategory">
              <option *ngFor="let sub of mainCategory?.subs" [ngValue]="sub.name">{{sub.name}}</option>
          </select> 
        </div>
  </div>
   <div>
    <button class="c2-ok-button" (click)="updateTitleAndSubtitle(ticketCategory,mainCategory.proname,subCategory)">SAVE AND CLOSE</button>
  </div>
</div>
</app-dialog>
<div *ngIf="imgGallery" style="position: fixed; top: 20%; right: 35%;" >
    <!-- <div class="video">
        <video controls (click)="movieplayer.play()" #videoPlayer  style="max-width: 500px; max-height: 500px;">
            <source src="https://res.cloudinary.com/maatayem/video/upload/v1543511853/maintenance/tickets/lll2mkwn5e9g1bmqq25spswv/manager/si1but89r0mopctkqdkx.mp4" type="video/mp4" />
            Browser not supported
        </video>
    </div> -->
    <!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/9bZkp7q19f0" frameborder="0" allowfullscreen></iframe> -->
    <iframe width="560" height="315" src="https://res.cloudinary.com/maatayem/video/upload/v1543511853/maintenance/tickets/lll2mkwn5e9g1bmqq25spswv/manager/si1but89r0mopctkqdkx.mp4" frameborder="0" allowfullscreen></iframe>
    <!-- <iframe width="560" height="315" src="https://res.cloudinary.com/maatayem/image/upload/v1543179166/maintenance/tickets/eqi20tcqlb03i4untdfdid5n/manager/ek3mterlqere3bjhyb8x.pdf" frameborder="0" allowfullscreen></iframe> -->
    <!-- <iframe width="560" height="315" src="https://res.cloudinary.com/maatayem/image/upload/v1543523572/maintenance/tickets/t5b4jkjopjnrxnxfue8eoimn/manager/pf76qbjhste5bvpprlfk.gif" frameborder="0" allowfullscreen></iframe> -->
    <!-- <iframe width="560" height="315" src="https://res.cloudinary.com/maatayem/image/upload/v1542709018/maintenance/tickets/9qg8kwtm07b8hkp6qe6k0rfn/manager/emw5m2xvdqhkhhnyhf1k.jpg" frameborder="0" allowfullscreen></iframe> -->
    <img src="/assets/img/x-icon.png" (click)="imgGallery = false;" style="cursor: pointer;">
</div>
